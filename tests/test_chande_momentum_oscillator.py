import unittest
import numpy as np

from sample_data import SampleData
from py_technical_indicators import chande_momentum_oscillator


class TestChandeMomentumOscillator(unittest.TestCase):
    def setUp(self):
        """Create data to use for testing."""
        self.close_data = SampleData().get_sample_close_data()
        self.high_data = SampleData().get_sample_high_data()
        self.low_data = SampleData().get_sample_low_data()
        self.volume = SampleData().get_sample_volume()

        self.cmo_period_6_expected = [np.nan, np.nan, np.nan, np.nan, np.nan,
        80.176826430898046, 68.630338733431685, 71.390194761584993,
        21.013900245298629, 15.987460815047497, 35.769922109047378,
        34.67397928092597, 0.87719298245605914, -22.222222222222403,
        -1.990811638591045, -72.986457590876313, -89.498644986449435,
        -92.664458116421869, -80.520889853499071, -91.68534746280794,
        -88.316151202748728, -36.450783259293893, 32.30994152046803,
        17.749120750292896, 45.64965197215777, 41.265822784809927,
        30.399999999999899, -27.88461538461582, -45.004582951420552,
        22.55866767600277, 3.1210191082803265, -32.561217736598479,
        -60.777521170130953, -6.8439831333117693, -9.781703049491778,
        32.36446354100849, 45.625774473358213, 71.037694658710407,
        13.148642947546085, 2.9846057178763563, -38.506391567616291,
        -11.762576909156715, 15.825457470339874, 100.0, 88.832743810005383,
        88.398950131233974, 83.921425973081554, 85.393258426966739,
        13.940520446096667, 13.169230769230685, 15.025594700391459,
        -21.817058096415074, -72.576594676042035, -64.055299539170264,
        -61.643835616438139, -49.902280130293434, -43.663003663003771,
        42.492753623188548, -13.663505444327464, -3.2981530343008236,
        -43.055555555555777, -28.439597315436838, -63.695150115473673,
        28.222409435551306, -4.0293040293045861, 53.547604608854115,
        50.897435897436551, 10.672308415608763, 36.454849498327953,
        45.164574143196454, -15.256293600242444, -29.161118508655104,
        -21.441228588304678, -70.410277662660306, -55.757575757575673,
        -55.504761904761658, -48.636763412488747, 12.056239015817427,
        -26.20822977078155, 3.4030860283238464, 42.048452866394697,
        48.274137068534131, -4.752620034121489, 8.0752212389379476,
        -55.631691648822525, -79.279723729650485, -50.538525269262379,
        -23.412443874278193, -0.83056478405333978, 29.319781078967505,
        34.06272793581315, 11.111111111110862, 62.609542356376735, 100.0, 100.0,
        35.222052067381945, 51.57412707498623, 46.658259773014358,
        39.180445722502533, 26.626192541197636, 75.691937424789472,
        -12.607944732297458, -1.8750000000000777, -73.34226389819267,
        -58.67565910484457, -44.606060606061, -28.467153284671408,
        -67.871136264692637, -80.974477958236406, -90.143937545742432,
        -96.282022217184092, -100.0, -90.106801573917991, -76.454849498327945,
        -35.563636363635972, -32.36641221374019, -32.776934749619997,
        -81.579855122455598, -76.615891313297467, -98.783106657122701,
        -76.556776556776924, -80.246913580247252, -73.608247422680847,
        -82.485549132948094, -68.389463154384742, -88.981958762886393,
        -54.519137986490726]

        self.cmo_period_8_expected = [np.nan, np.nan, np.nan, np.nan, np.nan,
        np.nan, np.nan, 84.22806368011851, 49.896265560165773,
        26.024691358024604, 27.632850241545963, 48.486304661220579,
        26.350093109870006, -16.287878787879059, -23.046092184368696,
        -47.440459895975913, -48.895395262177217, -83.889479277364245,
        -84.674493062966377, -87.633482604202101, -85.852216748767958,
        -55.259259259259238, -9.5452273863066726, -9.4698232744248756,
        7.9952267303104385, 1.5776699029125645, 49.280230326295424,
        49.029940119760141, 0.23059185242129548, -9.1979809310153939,
        -15.213406650955674, -13.468733297701984, -44.325997248968427,
        -18.743811005800019, -5.7066936606352083, 31.015706806282768,
        28.157033805888844, 23.096260605425734, 5.3235346836351125,
        31.929901906756335, 21.25462195588419, 28.970672800460086,
        6.5233842893899645, 10.931641188347182, 24.870129870130032,
        90.268604139146063, 91.295785742418531, 91.457286432161084,
        40.077653149266538, 26.43678160919551, 18.745332337565582,
        9.504132231404915, -28.544706322484064, -48.629441624365235,
        -74.354156881164727, -31.84762891940915, -31.438998957247072,
        -34.453333333333738, -45.811287477954416, -11.366384522370087,
        -10.308962985622619, -3.8244885858289051, -40.035149384886132,
        -18.409622452389428, -43.102803738318023, 45.147271849348122,
        40.241977906365214, 5.6259904912835372, 33.814948596832643,
        45.039051200462907, 2.3200191341784819, -6.2664329535495185,
        -34.428537901900668, -28.661275831086996, -3.5768261964734345,
        -64.203354297693778, -69.982009766126865, -16.303491730112675,
        -26.169522927281001, 14.016933207902223, 17.982770997846334,
        12.935797294722734, 12.124077926990671, 4.7349823321553863,
        -18.668054110301842, 8.6475615887379416, -23.942701227830824,
        -55.173701905117632, -58.339148639218351, -16.506814740030052,
        29.948066935949271, 43.990086741015666, 46.094215861657254,
        43.393863494050649, 76.059850374064041, 53.89645776566838,
        59.365994236311813, 55.285412262156818, 57.07762557077681,
        51.098265895954412, 31.097961867193145, -1.2846517917507965,
        46.818923327895213, -50.728013977869047, -45.802816901408718,
        -45.393258426966923, -41.189307146753876, -59.955423476968839,
        -78.513055610922905, -85.899885364921474, -84.29118773946341,
        -91.109154929577073, -88.782608695652016, -92.96703296703302,
        -79.452690166975643, -58.384217942695884, -49.744753261485691,
        -71.308290155440105, -70.245795601552317, -83.990980834272648,
        -65.10107015457784, -82.359426681367452, -84.772781346657425,
        -87.772258311043416, -73.081140350877291, -76.528843773211136,
        -48.769972102460024]

        self.cmo_period_10_expected = [np.nan, np.nan, np.nan, np.nan, np.nan,
        np.nan, np.nan, np.nan, np.nan, 53.722582638245242, 46.018018018017955,
        47.06713780918713, 21.224009415457356, 0.32467532467539778,
        -0.75484082704267619, -40.326781908595862, -55.276030747728825,
        -65.417867435158485, -57.595628415300339, -81.447891805886613,
        -88.179124135659762, -56.58158875824477, -24.334300026364176,
        -30.348896870189847, -21.611087050671131, -18.6760521192152,
        15.344467640918632, 11.826024442846721, 22.69769276276865,
        35.922330097087269, 7.4007220216606937, -30.604372053150659,
        -50.146266358737535, -10.848632687122942, 1.5135515663498378,
        19.697694441787103, 24.548410404624381, 23.301144492131584,
        -4.1279164627181828, 1.8810111498851274, 11.152228763666953,
        45.834064199263288, 38.184365929336394, 38.869642680391955,
        15.088529638183241, 13.263433813892563, 36.428571428571537,
        92.516085336945721, 60.114860014357461, 50.43280182232359,
        39.834101382488591, 20.909254916110488, -21.052631578947238,
        -21.091811414392044, -32.052650302383448, -29.202923773059453,
        -49.876119687440443, -21.788940295219298, -37.07904998227589,
        -45.021563847740723, -40.863251311012732, -11.098931214031529,
        -11.511183851609575, -0.050226017077086134, -27.213114754098662,
        1.2638638122256898, -9.8737083811709532, 6.5852002715544673,
        30.152284263959395, 38.194084068500366, 4.6764091858037675,
        -1.1824990145841965, -16.851311953352639, -8.8766394221629685,
        -18.224974200206145, -34.619982920580561, -26.680712507182356,
        -32.279999999999895, -46.284751474304912, -3.4878165312946936,
        13.096187589727275, 21.652665866620925, -1.644245142003024,
        -14.223701345680857, -1.0185339789614523, 5.31384921952829,
        -5.5534987041836379, 10.242005185825438, -34.10165484633589,
        -46.434333656017841, -33.667157584683054, 0.34542314335077828,
        40.461010299166063, 58.796718322697714, 59.893522626441374,
        23.480542195015317, 50.878594249201392, 65.055762081784891,
        63.313096270599004, 58.447937131631143, 50.118990956687725,
        27.140077821012092, 21.816283924843457, -31.21895299961805,
        -9.6145700974168395, -29.141716566866645, -30.905412240768364,
        -59.744861800141976, -79.824068875163803, -80.849173920767498,
        -81.528444139821843, -87.004754358161478, -77.695927972170935,
        -85.481083157287983, -80.388494583488622, -84.287994325234806,
        -81.148936170212536, -77.32275403122577, -73.989256432004481,
        -75.381321915975263, -62.105785944872117, -73.208580556823307,
        -75.72875749431465, -88.616150836001651, -81.901953556948101,
        -83.106829520041387, -55.270034843205615]

    def test_cmo_period_6(self):
        period = 6
        cmo = chande_momentum_oscillator.chande_momentum_oscillator(self.close_data, period)
        np.testing.assert_array_equal(cmo, self.cmo_period_6_expected)

    def test_cmo_period_8(self):
        period = 8
        cmo = chande_momentum_oscillator.chande_momentum_oscillator(self.close_data, period)
        np.testing.assert_array_equal(cmo, self.cmo_period_8_expected)

    def test_cmo_period_10(self):
        period = 10
        cmo = chande_momentum_oscillator.chande_momentum_oscillator(self.close_data, period)
        np.testing.assert_array_equal(cmo, self.cmo_period_10_expected)

    def test_cmo_invalid_period(self):
        period = 128
        with self.assertRaises(Exception) as cm:
            chande_momentum_oscillator.chande_momentum_oscillator(self.close_data, period)
        expected = "Error: data_len < period"
        self.assertEqual(str(cm.exception), expected)
